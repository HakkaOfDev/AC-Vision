<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AC-Vision | Login</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/tailwind.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='icons/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/toasty.min.css') }}">
</head>
<body>
<main class="login-container w-screen h-screen">
    <div class="w-full h-full flex flex-col justify-center items-start">
        <div class="w-1/4 h-full rounded bg-white bg-opacity-90 shadow-lg flex flex-col items-center justify-center p-8 space-y-4">
            <img class="" src="{{ url_for('static', filename='img/logo_bleu.png') }}" alt>
            <form class='flex flex-col justify-center items-center space-y-4 mt-4' id="login_form" role="form">
                <div class='flex flex-row justify-between items-center space-x-2'>
                    <span class='icon-user text-blue-800 text-2xl'></span>
                    <label>
                        <input placeholder="Login..." name="username" id="username"
                               class='w-64 pl-2.5 text-lg border bg-gray-100 rounded-full focus:border-gray-900 border-transparent outline-none border-transparent focus:bg-white p-1'
                               type='text' required/>
                    </label>
                </div>
                <div class='flex flex-row justify-between items-center space-x-2'>
                    <span class='icon-key text-blue-800 text-2xl'></span>
                    <label>
                        <input placeholder="Password..." name="password" id="password"
                               class='w-64 pl-2.5 text-lg border bg-gray-100 rounded-full focus:border-gray-900 border-transparent outline-none border-transparent focus:bg-white p-1'
                               type='password' required/>
                    </label>
                </div>
                <label>
                    <input class='text-lg rounded-full bg-blue-800 hover:bg-blue-500 text-white p-1 px-2.5 border-transparent cursor-pointer'
                           type="submit" value="Submit"/>
                </label>
            </form>
        </div>
    </div>
</main>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/cookie.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/toasty.min.js') }}"></script>
<script type="text/javascript">
    $('#login_form').submit((event) => {
        event.preventDefault();
        data = {
            username: document.getElementById("username").value,
            password: document.getElementById("password").value
        }
        let request = $.post('http://ac-vision/api/v1.0/ressources/login/token', data)
        request.fail((data) => {
            new Toasty({
                duration: 3000, transition: "fade", progressBar: true, autoClose: true
            }).error(data.responseJSON.detail)
        })
        request.done((data) => {
            let user = $.ajax({
                url: "http://ac-vision/api/v1.0/ressources/users/me",
                headers: {'Accept': 'application/json', 'Authorization': 'Bearer ' + data.access_token}
            });
            user.done((user) => {
                user['access_token'] = data.access_token
                $.cookie.json = true;
                $.cookie.raw = true;
                $.cookie("user", user, {expires: 7});
                new Toasty({
                    duration: 1500, transition: "fade", progressBar: true, autoClose: true, onHide: () => {
                        $(location).attr("href", "/dashboard");
                    }
                }).success(data.message)
            })

        });
    })
</script>
</body>
</html>